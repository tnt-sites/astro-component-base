---
import ComponentProperties from "../components/ComponentProperties/index.astro";
import ComponentViewer from "../components/ComponentViewer/index.astro";
import LibraryLayout from "./LibraryLayout.astro";

const { frontmatter, schema, examples = [], componentKey = "" } = Astro.props;
const meta = schema?.meta?.();

const primaryExample = examples.find((example: any) => example.slug.includes("/primary"));

const frontmatterExamples = frontmatter.examples || [];
const processedExamples = frontmatterExamples.map((exampleConfig: any) => {
  const matchingExamples = examples.filter((example: any) =>
    example.slug.includes(`/${exampleConfig.slugs}`)
  );

  return {
    title: exampleConfig.title,
    examples: matchingExamples,
    size: exampleConfig.size,
  };
});

const primarySize = frontmatter.primary_size || "md";
---

<LibraryLayout frontmatter={frontmatter}>
  <h1>{meta.title}</h1>
  <p>{meta.description}</p>

  {
    primaryExample && (
      <ComponentViewer
        component_examples={[primaryExample]}
        title={meta.title}
        size={primarySize}
        componentKey={componentKey}
      />
    )
  }

  <h2>Properties</h2>
  <ComponentProperties shape={schema?.shape} />

  {processedExamples.length > 0 && <h2>Examples</h2>}

  {
    processedExamples.map((exampleGroup: any) => (
      <>
        <h3>{exampleGroup.title}</h3>
        {exampleGroup.examples.length > 0 && (
          <ComponentViewer
            component_examples={exampleGroup.examples}
            title={exampleGroup.title}
            size={exampleGroup.size}
            componentKey={componentKey}
          />
        )}
      </>
    ))
  }

  <slot />
</LibraryLayout>
