---
import AccordionItem from "./accordion-item.astro";

const { items, openFirst, singleOpen = false, label, ...rest } = Astro.props;

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(([key]) => key !== "_component")
);

const slugifyLabel = (label: string) => {
  return label
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");
};

const generatedLabel = label || `Accordion-${crypto.randomUUID()}`;

if (!htmlAttributes.id) {
  htmlAttributes.id = slugifyLabel(generatedLabel);
}

const accordionName = singleOpen ? `accordion-${crypto.randomUUID()}` : undefined;
---

<div
  class:list={["accordion"]}
  data-editable="array"
  data-prop="items"
  data-component-key="_component"
  data-id-key="_component"
  {...htmlAttributes}
>
  {
    items ? (
      items.map((item: any, index: number) => {
        const isFirst = index === 0 && openFirst;

        return (
          <editable-array-item data-component="building-blocks/wrappers/accordion/accordion-item">
            <AccordionItem
              title={item.title}
              contentSections={item.contentSections}
              isOpen={isFirst}
              accordionName={accordionName}
            />
          </editable-array-item>
        );
      })
    ) : (
      <slot />
    )
  }
</div>

<style lang="pcss">
  .accordion {
    margin-top: var(--spacing-lg);
  }
</style>
