---
import Component from "@components/utils/renderBlock.astro";

const {
  direction = "row",
  alignX = "start",
  buttonSections,
  editable = true,
  class: className,
  label,
  ...rest
} = Astro.props;

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(([key]) => key !== "_component")
);

const slugifyLabel = (label: string) => {
  return label
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");
};

if (!htmlAttributes.id && label) {
  htmlAttributes.id = slugifyLabel(label);
}

const alignMap = {
  start: "align-start",
  center: "align-center",
  end: "align-end",
} as const;

const alignClass = alignMap[alignX as keyof typeof alignMap] ?? "align-start";
---

<div
  class:list={["button-group", direction === "column" ? "column" : "row", alignClass, className]}
  {...htmlAttributes}
>
  {
    buttonSections && buttonSections.length > 0 ? (
      <Component contentSections={buttonSections} editable={editable} propName="buttonSections" />
    ) : (
      <slot />
    )
  }
</div>

<style lang="pcss">
  .button-group {
    position: relative;
    margin-top: var(--spacing-lg);
    container-type: inline-size;
    width: 100%;

    &, :global(> editable-array) {
      align-items: center;
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    &.column {
      &, :global(> editable-array) {
        flex-direction: column;
      }

      &.align-start {
        &, :global(> editable-array) {
          align-items: flex-start;
        }
      }

      &.align-center {
        &, :global(> editable-array) {
          align-items: center;
        }
      }

      &.align-end {
        &, :global(> editable-array) {
          align-items: flex-end;
        }
      }
    }

    &.row {
      &, :global(> editable-array) {
        flex-direction: row;
      }
    }

    &.align-center {
      &, :global(> editable-array) {
        justify-content: center;
      }
    }

    &.align-end {
      &, :global(> editable-array) {
        justify-content: flex-end;
      }
    }

    &.align-start {
      &, :global(> editable-array) {
        justify-content: flex-start;
      }
    }
  }
</style>
