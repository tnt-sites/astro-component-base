---
import SmartImage from "@components/elements/smart-image/smart-image.astro";
import Heading from "@components/typography/heading/heading.astro";
import SimpleText from "@components/typography/simple-text/simple-text.astro";
import Card from "@components/wrappers/card/card.astro";
import GridItem from "@components/wrappers/grid/grid-item.astro";
import Grid from "@components/wrappers/grid/grid.astro";

const { blogPosts = [], class: className, ...rest } = Astro.props;

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(([key]) => key !== "_bookshop_name")
);
---

<section class:list={["blog-block", className]} {...htmlAttributes}>
  <Grid minItemWidth={280} layout="tiles">
    {
      blogPosts.map((post) => (
        <GridItem>
          <Card
            paddingHorizontal="md"
            paddingVertical="md"
            rounded={true}
            border={true}
            link={post.url || post.slug || "#"}
            title={post.title || "Untitled Post"}
          >
            <div slot="header">
              <SmartImage
                source={post.imageSource || post.featuredImage || ""}
                alt={post.imageAlt || post.title || "Blog post image"}
              />
            </div>

            <Heading type="h3" class="blog-post-title">
              {post.title || "Untitled Post"}
            </Heading>

            <SimpleText class="blog-post-date" size="xs" color="muted" weight="medium">
              {post.date ? new Date(post.date).toLocaleDateString() : ""}
            </SimpleText>

            <SimpleText class="blog-post-excerpt" size="sm" color="secondary">
              {post.excerpt || post.description || ""}
            </SimpleText>
          </Card>
        </GridItem>
      ))
    }
  </Grid>

  {
    blogPosts.length === 0 && (
      <div class="blog-empty">
        <SimpleText>No blog posts to display.</SimpleText>
      </div>
    )
  }
</section>

<style>
  .blog-block {
    .card:hover {
      p {
        color: var(--color-text);
      }

      h3 {
        text-decoration: underline;
      }
    }

    .blog-post-title,
    .blog-post-excerpt {
      margin: 0;
    }

    .blog-post-date {
      color: var(--color-text-muted);
      font-size: var(--font-size-xs);
      margin-block: var(--spacing-xs);
    }
  }
</style>
