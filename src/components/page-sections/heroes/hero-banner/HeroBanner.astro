---
import CustomSection from "@builders/custom-section/CustomSection.astro";
import Button from "@building-blocks/core-elements/button/Button.astro";
import Heading from "@core-elements/heading/Heading.astro";
import Image from "@core-elements/image/Image.astro";
import Text from "@core-elements/text/Text.astro";
import Video from "@core-elements/video/Video.astro";
import Split from "@wrappers/split/Split.astro";

const {
  eyebrowHeading = "",
  heading = "",
  bodyText = "",
  backgroundColor = "base",
  backgroundVideo,
  backgroundImage,
  secondaryVideo,
  class: className,
  editable = true,
  ...rest
} = Astro.props;

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(([key]) => key !== "_component")
);
---

<CustomSection
  class:list={["hero-banner", className]}
  maxContentWidth=""
  paddingHorizontal=""
  paddingVertical=""
  colorScheme="contrast"
  backgroundColor={backgroundColor}
  {...htmlAttributes}
>
  <Split
  distributionMode="half"
  minSplitWidth={979}
  verticalAlignment="center"
  gap="wave"
  class="hero-banner-split"
  >
    <Fragment slot="first">
      {
        backgroundImage && backgroundImage.source ? (
          <Image
            source={backgroundImage.source}
            alt={backgroundImage.alt}
            rounded={false}
            editable={true}
            aspectRatio=""
            data-prop-src="backgroundImage.source"
            data-prop-alt="backgroundImage.alt"
            class="hero-banner-background-image"
          />
        ) : backgroundVideo && backgroundVideo.type ? (
          <Video
            type={backgroundVideo.type}
            source={backgroundVideo.source}
            autoPlay={true}
            muted={true}
            loop={true}
            controls={false}
            class="hero-banner-background-video"
          />
        ) : null
      }
      <Image source="/src/assets/images/wave-internal-mobile.png" alt="Several shades of pink and purple wavy lines" rounded={false} editable={false} class="hero-banner-wave-mobile" />
    </Fragment>
    <Fragment slot="second">
      <div class="hero-banner-wave-desktop">
        <Image
          source="/src/assets/images/banner-wave-1.svg"
          alt="Decorative wavy dark purple line"
          rounded={false}
          editable={false}
          class="wave wave-1"
        />
        <Image
          source="/src/assets/images/banner-wave-2.svg"
          alt="Decorative wavy dark purple line"
          rounded={false}
          editable={false}
          class="wave wave-2"
        />
        <Image
          source="/src/assets/images/banner-wave-3.svg"
          alt="Decorative pink wavy line"
          rounded={false}
          editable={false}
          class="wave wave-3"
        />
      </div>
      <Heading
      level="h1"
      size="xs"
      alignX="center"
      class="hero-banner-eyebrow"
      data-prop="eyebrowHeading"
      >
        {eyebrowHeading}
      </Heading>
    
      <Heading
      level="h2"
      size="4xl"
      alignX="center"
      class="hero-banner-heading"
      data-prop="heading"
      >
        {heading}
      </Heading>
      <Text alignX="center" data-prop="bodyText" text={bodyText} class="hero-banner-body-text" />
      {secondaryVideo && (secondaryVideo.source || secondaryVideo.id) && (
        <Button text="Play Video" iconName="play" editable={false} hideText={true} variant="secondary" rounded={true} class="hero-banner-play-button" size="lg" />
      )}
    </Fragment>
  </Split>
  {secondaryVideo && (secondaryVideo.source || secondaryVideo.id) && (
    <CustomSection class="hero-banner-secondary-video-container" maxContentWidth="xl" paddingHorizontal="lg" paddingVertical="none" backgroundColor="none">
      <Button 
        text="CLOSE VIDEO" 
        iconName="x-mark" 
        iconPosition="before" 
        variant="primary" 
        class="hero-banner-close-video"
        editable={false}
        rounded={false}
      />
      <Video {...secondaryVideo} class="hero-banner-secondary-video" />
    </CustomSection>
  )}
</CustomSection>

<script>
  function initVideoToggle() {
    const playButton = document.querySelector('.hero-banner-play-button');
    const closeButton = document.querySelector('.hero-banner-close-video');
    const splitSection = document.querySelector('.hero-banner-split');
    const videoContainer = document.querySelector('.hero-banner-secondary-video-container');

    if (!playButton || !closeButton || !splitSection || !videoContainer) return;

    playButton.addEventListener('click', () => {
      splitSection.style.display = 'none';
      videoContainer.style.display = 'block';
    });

    closeButton.addEventListener('click', () => {
      splitSection.style.display = 'grid';
      videoContainer.style.display = 'none';
    });
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initVideoToggle);
  } else {
    initVideoToggle();
  }
</script>

<style lang="pcss" is:global>
  @layer page-sections {
    .hero-banner {
      overflow: hidden;

      .hero-banner-eyebrow {
        text-transform: uppercase;
        letter-spacing: var(--font-letter-spacing-eyebrow);
      }

      .hero-banner-heading {
        margin: 0;
      }

      .pane.first {
        position: relative;
        height: 100%;
      }

      .hero-banner-background-video {
          object-fit: cover;
          object-position: center center;
          height: 100%;
          @media (--from-md) {
            width: 440px;
            aspect-ratio: 1 / 1.1;
          }
          @media (--from-lg) {
            width: 460px;
          }
          @media (--from-xl) {
            width: 590px;
          }
          @media (--from-2xl) {
            width: 700px;
          }
          @media (--from-2xl) {
            width: 700px;
          }
          @media (width >= 2000px) {
            width: 960px;
            aspect-ratio: 1 / 0.8;
          }
      }
      .hero-banner-background-image {
        width: 100%;
        height: 100%;
        
        
        picture {
          height: 100%;
        }
        
        img {
          object-fit: cover;
          height: 100%;
          @media (--from-md) {
            width: 440px;
            aspect-ratio: 1 / 1.1;
          }
          @media (--from-lg) {
            width: 460px;
          }
          @media (--from-xl) {
            width: 590px;
          }
          @media (--from-2xl) {
            width: 700px;
          }
          @media (width >= 2000px) {
            width: 960px;
            aspect-ratio: 1 / 0.8;
          }
        }
      }

      .pane.second {
        max-width: 600px;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: var(--spacing-lg);
        justify-self: center;
        z-index: 1;

        @media (--from-md) {
          justify-self: left;
        }

        @media (width >= 1950px) {
          justify-self: center;
        }
      }

      .hero-banner-wave-mobile {
        picture, img {
          height: 20vh;
          width: 100%;
        }
        img {
          position: absolute;
          bottom: calc(var(--spacing-wave) * -1);
          animation: scaleXAnimation1 2s infinite alternate ease-in-out;
        }

        @media (--from-md) {
          display: none;
        }
      }

      .hero-banner-wave-desktop {
        display: none;
        z-index: -1;

        @media (--from-md) {
          display: block;
          position: absolute;
          top: -4%;
          left: 110px;
          width: 100%;
          height: 104%;
        }
        @media (--from-lg) {
          left: 150px;
        }
        @media (--from-xl) {
          left: 350px;
        }
        @media (--from-2xl) {
          left: 300px;
        }
        @media (width >= 2000px) {
          left: 600px;
        }

        .wave {
          height: 100%;
          picture {
            height: 100%;
          }
          img {
            height: 100%;
            position: absolute;
            -o-object-fit: cover;
            object-fit: cover;
            transition: all 1s;
            width: auto;
          }
        }
        .wave-1 img {
          inset: 0 auto 0 0;
          animation: scaleXAnimation1 2s infinite alternate ease-in-out;
          @media (--from-xl) {
            inset: 0 auto 0 -100px;
          }
        }
        .wave-2 img {
          inset: 0 auto 0 150px;
          animation: scaleXAnimation2 2s infinite alternate ease-in-out;
          @media (--from-xl) {
            inset: 0 auto 0 100px;
          }
        }
        .wave-3 img {
          inset: 0 auto 0 345px;
          animation: scaleXAnimation1 2s infinite alternate ease-in-out;
        }
      }
    }
    
    .hero-banner-body-text p {
      margin: 0;
    }

    .hero-banner-play-button {
      width: 60px;
      height: 60px;
      border-radius: 100%;
      margin: var(--spacing-lg) auto;

      &:hover {
        background-color: var(--color-bg-brand);
      }
    }

    .hero-banner-close-video {
      position: absolute;
      top: 0;
      right: 15px;
      z-index: 1;
    }
    .hero-banner-secondary-video-container {
      display: none;

      .video {
        margin-top: 0;
      }
    }
  }
</style>