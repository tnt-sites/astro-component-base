---
import AccordionItem from "./accordion-item.astro";

const { items, openFirst, singleOpen = false, label, ...rest } = Astro.props;

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(([key]) => key !== "_bookshop_name")
);

const slugifyLabel = (label: string) => {
  return label
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");
};

if (!htmlAttributes.id && label) {
  htmlAttributes.id = slugifyLabel(label);
}

const accordionName = singleOpen ? `accordion-${crypto.randomUUID()}` : undefined;
---

<div class:list={["accordion"]} {...htmlAttributes}>
  {
    items ? (
      items.map((item: any, index: number) => {
        const isFirst = index === 0 && openFirst;

        return (
          <AccordionItem
            title={item.title}
            contentBlocks={item.contentBlocks}
            isOpen={isFirst}
            accordionName={accordionName}
          />
        );
      })
    ) : (
      <slot />
    )
  }
</div>
